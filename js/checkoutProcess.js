var n=(r,e,t)=>new Promise((o,s)=>{var a=i=>{try{l(t.next(i))}catch(c){s(c)}},h=i=>{try{l(t.throw(i))}catch(c){s(c)}},l=i=>i.done?o(i.value):Promise.resolve(i.value).then(a,h);l((t=t.apply(r,e)).next())});import{setLocalStorage as u,getLocalStorage as m,alertMessage as p,removeAllAlerts as d}from"./utils.js";import g from"./ExternalServices.js";const T=new g;function x(r){let e=new FormData(r);const t=Object.fromEntries(e.entries());return t}function S(r){const e=r.map(t=>(console.log(t),{id:t.Id,price:t.FinalPrice,name:t.Name,quantity:1}));return e}export default class y{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=m(this.key),this.calculateItemSummary()}calculateItemSummary(){const e=document.querySelector(this.outputSelector+" #cartTotal"),t=document.querySelector(this.outputSelector+" #num-items");t.innerText=this.list.length;const o=this.list.map(s=>s.FinalPrice);this.itemTotal=o.reduce((s,a)=>s+a),e.innerText="$"+this.itemTotal}calculateOrdertotal(){this.shipping=10+(this.list.length-1)*2,this.tax=(this.itemTotal*.06).toFixed(2),this.orderTotal=(parseFloat(this.itemTotal)+parseFloat(this.shipping)+parseFloat(this.tax)).toFixed(2),this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(this.outputSelector+" #shipping"),t=document.querySelector(this.outputSelector+" #tax"),o=document.querySelector(this.outputSelector+" #orderTotal");e.innerText="$"+this.shipping,t.innerText="$"+this.tax,o.innerText="$"+this.orderTotal}checkout(){return n(this,null,function*(){const e=document.forms.checkout,t=x(e);t.orderDate=new Date,t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=S(this.list),console.log(t);try{const o=yield T.checkout(t);console.log(o),u("so-cart",[]),location.assign("/checkout/checkedout.html")}catch(o){d();for(let s in o.message)p(o.message[s]);console.log(o)}})}}
